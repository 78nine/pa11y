#!/usr/bin/env node
'use strict';

var pkg = require('../package.json');
var program = require('commander');
var pa11y = require('../lib/pa11y');

configureProgram(program);
runProgram(program);

function configureProgram (program) {
	program.version(pkg.version)
		.usage('[options] <url>')
		.option('-p, --port <port>', 'the port to run PhantomJS on')
		.parse(process.argv);
	program.url = program.args[0];
}

function runProgram (program) {
	if (!program.url || program.args[1]) {
		program.help();
	}
	var options = {
		phantom: {
			port: program.port
		}
	};
	pa11y(options, function (error, test, exit) {
		if (error) {
			console.error(error);
			process.exit(1);
		}
		test(program.url, function (error, results) {
			if (error) {
				console.error(error);
				process.exit(1);
			}
			console.log(results);
			exit();
		});
	});
}
